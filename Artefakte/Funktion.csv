Name;Signatur;Kategorie;Typ;Beschreibung;Code
h2ps_berechneStandort;;Husst BerechnungsSchritt Funktionen;H;;"{:setzeVariable4002(Standort
        ; wenn3016( istGleich3014(alsText3091(leseEingangsparameter4026(VerkaufsStandortTyp));""ReferenzExtern"")
			; H2Pf_2_ermittleOrtspunktMitRefExt(leseEingangsparameter4026(VerkaufsStandortSchluessel))
			; wenn3016( istGleich3014(alsText3091(leseEingangsparameter4026(VerkaufsStandortTyp));""IBISnr"")
            	; H2Pf_2_ermittleOrtspunktMitRefExt(leseEingangsparameter4026(VerkaufsStandortSchluessel))
				; liefereAusnahme3042(undefiniert))
        )
    )
}"
h2ps_berechneBediengebiet;;Husst BerechnungsSchritt Funktionen;H;;{:H2Pf_2_ermittleBediengebietVonOrtspunkt(leseVariable4001(Standort))}
h2ps_berechneStartpunkt;;Husst BerechnungsSchritt Funktionen;H;;"{:setzeVariable4002(StartTarifrelevanterpunkt;H2Pf_3_ermittleStartpunktZuOrtspunkt(leseVariable4001(Standort)))}"
h2ps_berechneStartpunktliste;;Husst BerechnungsSchritt Funktionen;H;;"{:H2Pf_4_ermittleStartpunkte(1/OTPTyp Start/;leseVariable4001(ID_Bediengebiet))}"
ErmittleStartpunktAuswahl;():Tarifpunkt;;H;;"{:setzeVariable4002(StartTarifrelevanterpunkt;
	/ermittleEinzelauswahl(leseVariable4001(ad.StartTarifpunkteAnzeigeNr); listeElement3071( leseVariable4001(ad.StartTarifpunkteAnzeigeNr);1))/
	ermittleTarifpunkt5035(listeElement3071(leseVariable4001(Startpunktliste); leseEingangsparameter4026(EP.RelationStartTarifpunktIndex)))
	)
}"
h2ps_berechneZielpunktliste;;Husst BerechnungsSchritt Funktionen;H;;"{:H2Pf_5_ermittleZielpunkte(2/OTPTyp Ziel/; leseVariable4001(ID_Bediengebiet))}"
ErmittleZielpunktAuswahl;():Tarifpunkt;;H;;"{:setzeVariable4002(ZielTarifrelevanterpunkt;
	/ermittleEinzelauswahl(leseVariable4001(ad.StartTarifpunkteAnzeigeNr); listeElement3071( leseVariable4001(ad.StartTarifpunkteAnzeigeNr);1))/
	ermittleTarifpunkt5035(listeElement3071(leseVariable4001(Zielpunktliste); leseEingangsparameter4026(EP.RelationZielTarifpunktIndex)))
	)
}"
ErmittleRelcodes;;;H;;"{: erzeugeListe3219(
	setzeVariable4002(
		StartRelationscode
		; listeElement3071(
				 ermittleZutarifpunkteZuZuordnungen5273(
		 		 	leseVariable4001(StartTarifrelevanterpunkt)
					; HUSST-Tarifrelevanterpunkt-zu-HUSST-RelCode
					; <Alle Verkehrsmittel>
				)
				; 1
		)
	)
	;setzeVariable4002(
		ZielRelationscode
		; listeElement3071(
				ermittleZutarifpunkteZuZuordnungen5273(
		 		 	leseVariable4001(ZielTarifrelevanterpunkt)
					; HUSST-Tarifrelevanterpunkt-zu-HUSST-RelCode
					; <Alle Verkehrsmittel>
				)
				; 1
		)
	)
)
}"
h2ps_;;Husst Testinitialisierung;H;;{:undefiniert}
h2ps_berechneEingangsparameter;;Husst BerechnungsSchritt Funktionen;H;;{:undefiniert} / TODO Schnittstelle abstimmen /
ErmittleViaListe;;;H;;"{:
setzeVariable4002(
	Vialiste
	;ermittleWertZuSchluesselVonDatentabelle5070(
		ermittleDatentabelle5262(6//)
		; erzeugeListe3219(
			ermittleNr5131(leseVariable4001(StartRelationscode))
			; ermittleNr5131(leseVariable4001(ZielRelationscode))
		)
	)
)
}"
ErmittleVerkaufsSortengruppeRelation;;;H;;"{:
setzeVariable4002(
	VerkaufsSortengruppe
	; ermittleTarifprodukteZuIdentifikationsparameterwerten5079(
		erzeugeListe3219(
			ermittleIdentifikationsparameterwert5088(
				Sortengruppe
				; 1 /VerkaufssortengruppeRelation/
			)
		)
	)
)
}"
ErmittleVerkaufsSortengruppeRelationAuswahl;;;H;;"{:
setzeVariable4002(
	VerkaufsSorteRelation
	; listeElement3071(
		leseVariable4001(VerkaufsSortengruppe)
		; leseEingangsparameter4026(EP.VerkaufsSortengruppeRelationIndex)
		)
	)
}"
ErmittlePreisdaten;Preisdaten;;H;;"{:
	setzeVariable4002(
		VerkaufPreisdaten
		; ermittlePreis5304(
				leseVariable4001(VerkaufsSorteRelation)
				; Euro-Cent
				; undefiniert /gewünschter Gültigkeitsbeginn/
				; undefiniert /konkreter Gültigkeitsbeginn/
				; undefiniert /Verkaufszeitpunkt/
				; <Alle Verkehrsmittel> / Verkehrsmittellinienbezug zu Verkehrsmittellinienbedingung der Bewertungsbedingung/
				; leseVariable4001(StartTarifpunkt)
				; leseVariable4001(ZielTarifpunkt)
				; undefiniert /Tarifpunkt[] Merfachvia in HUSST nicht unterstützt/
				; leseVariable4001(ViaWegevariante)
				; undefiniert /Bezahlart/
				; undefiniert /Zahlungsintervall/
				; undefiniert /Rabattmedientyp/
				; undefiniert /Mitnahmetyp[]/
				; undefiniert /Zahl[] (Mitnahmeanzahl)/
		)
	)
}"
ErmittleViaListeAuswahl;;;H;;"{:
setzeVariable4002(
	VerkaufsVia
	; listeElement3071(
		leseVariable4001(Vialiste)
		; leseEingangsparameter4026(EP.RelationViaIndex)	
	)
)
}"
SetzePreisparameter;;;H;;"{:
	erzeugeListe3219(
		setzeVariable4002(
			StartTarifpunkt
			; ermittleTarifpunkt5035(
				listeElement3071(
					leseVariable4001(VerkaufsVia)
					; 1 /StartarifpunktNr/
				)
			)
		)
		; setzeVariable4002(
			ZielTarifpunkt
			; ermittleTarifpunkt5035(
				listeElement3071(
					leseVariable4001(VerkaufsVia)
					; 2 /ZieltarifpunktNr/
				)
			)
		)
		; setzeVariable4002(
			ViaWegevariante
			; ermittleWegevariante5333(
				listeElement3071(
					leseVariable4001(VerkaufsVia)
					; 3 /WegevarianteNr (Via)/
				)
			)
		)
	)
}"
ErmittlePreisdetails;[Zahl, Zahl];;H;;"{:
	erzeugeListe3219(
		setzeVariable4002(
			VerkaufPreisBetrag
			; ermittleBetragVonPreis5246(leseVariable4001(VerkaufPreisdaten))
		)
		;  setzeVariable4002(
			VerkaufPreisMwSt
			; ermittleMwstsatzVonPreis5018(leseVariable4001(VerkaufPreisdaten))
		)
	)
}"
setzeVariable4002;;PkmFachfunktionen;S;;4002
leseVariable4001;;PkmFachfunktionen;S;;4001
leseEingangsparameter4026;;PkmFachfunktionen;S;;4026
ermittleWertZuSchluesselVonDatentabelle5070;;PkmFachfunktionen;S;;5070
ermittleDatentabelle5262;;PkmFachfunktionen;S;;5262
listeElement3071;;PkmFachfunktionen;S;;3071
ermittleTarifpunkteVonReferenz5008;;PkmFachfunktionen;S;;5008
ermittleTarifpunktreferenz5337;;PkmFachfunktion;S;;5337
alsListe3238;;PkmFachfunktionen;S;;3238
alsText3091;;PkmFachfunktionen;S;;3091
istGleich3014;;PkmFachfunktionen;S;;3014
wenn3016;;PkmFachfunktionen;S;;3016
listeErgaenzt3077;;PkmFachfunktionen;S;;3077
listeAbschnitt3074;;PkmFachfunktionen;S;;3074
listeLaenge3072;;PkmFachfunktionen;S;;3072
zahlSubtrahiert3218;;PkmFachfunktionen;S;;3218
ermittleTarifpunkt5035;;PkmFachfunktionen;S;;5035
textVerkettet3068;;PkmFachfunktionen;S;;3068
H2Pf_806_ermittleTarifpunktZuExterneReferenz;"(Text/Zahl/Null;Text/Zahl/Null;Text/Zahl/Null;):TarifpunktItem/Null";Husst Fachfunktionen;H;;"{HusstTyp;ReferenzName;ReferenzWert
	:ermittleTarifpunkt5035(
        ermittleWertZuSchluesselVonDatentabelle5070(
            ermittleDatentabelle5262(""%HusstTarifpunktreferenzNummern%"") /kompilezeit konstantenmusster/
            ; H2Pf_805_ermittleSchluesselZuNameWertPaaren(alsText3091($HusstTyp); alsListe3238($ReferenzName);  alsListe3238($ReferenzWert))
        )
    )
}"
H2Pf_805_ermittleSchluesselZuNameWertPaaren;"Schluessel: NULL, Text
;Namen : NULL, {Text / Zahl}[]; 
Werte : NULL, {Text / Zahl}[] -> Text";Husst Fachfunktionen;H;;{:undefiniert}
H2Pf_2_ermittleBediengebietVonOrtspunkt;NULL,Ortspunkt: Xml-Tarifpunkt-Item ->NULL,Zahl;Husst Fachfunktionen;H;;"{Ortspunkt:  / Ortspunkt [TarifpunktNr,ID_Bediengebiet] /
	setzeVariable4002(ID_Bediengebiet
        ;listeElement3071(
			$Ortspunkt
			; 2
        )
    )
}"
H2Pf_3_ermittleStartpunktZuOrtspunkt;"Ortspunkt: [Xml-Tarifpunkt-Item.Nr;ID_Bediengebiet]";Husst Fachfunktionen;H;;"{Ortspunkt:
	ermittleZutarifpunkteZuZuordnungen5272(ermittleTarifpunkt5035(listeElement3071($Ortspunkt;1))
		; HUSST-Ortspunkt-zu-Tarifrelevanterpunkt-mit-OTPTyp-1-und-Bediengebiet-1 /zuordnungstyp %HUSST-Ortspunkt-zu-Tarifrelevanterpunkt-mit-OTPTyp-1-und-Bediengebiet-1%/
		; <Alle Verkehrsmittel> /verkehrsmittellinienbezug %Alle Verkehrsmittel% const/
	)
}"
ermittleZutarifpunkteZuZuordnungen5272;;PkmFachfunktionen;S;;5272
H2Pf_800_ermittleZuordnungstyp;HusstZuordnung: NULL / Text ReferenzNamen:  NULL / {Text / Zahl} / {Text / Zahl}[] ReferentWerte:  NULL / {Text / Zahl} / {Text / Zahl}[] -> NULL,XML-Zuordnungstyp-Item;Husst Fachfunktionen;H;;"{HusstZuordnung;ReferenzNamen;ReferenzWerte:
    ermittleWertZuSchluesselVonDatentabelle5070(
        ermittleDatentabelle5262(""%HusstZuordnungstypen%"")
        ;H2Pf_805_ermittleSchluesselZuNameWertPaaren(
            $HusstZuordnung
            ; alsListe3238($ReferenzNamen)
            ; alsListe3238($ReferenzWerte)
        )
    )
}"
H2Pf_4_ermittleStartpunkte;NULL,ID_OTPTyp: Zahl NULL,ID_Bediengebiet: Zahl;Husst Fachfunktionen;H;;"{ID_OTPTyp;ID_Bediengebiet:
	setzeVariable4002(Startpunktliste
 	       ; ermittleWertZuSchluesselVonDatentabelle5070(
				ermittleDatentabelle5262(5 /HUSST-OTPTyp-Bediengebiet-zu-Tarifrelevanterpunkt/)
				; erzeugeListe3219($ID_OTPTyp; $ID_Bediengebiet)
			)
  	)
}"
H2Pf_801_ermittleTarifpunktreferenzNummer;HusstTarifpunktreferenz: NULL / Text - ReferenzNamen:  NULL / {Text / Zahl} / {Text / Zahl}[] - ReferentWerte:  NULL / {Text / Zahl} / {Text / Zahl}[] ->NULL,Zahl;Husst Fachfunktionen;H;;"{HusstTarifpunktreferenz;ReferenzNamen;ReferenzWerte:
    ermittleWertZuSchluesselVonDatentabelle5070(
        ermittleDatentabelle5262(""%HusstTarifpunktreferenzNummern%"")
        ; H2Pf_805_ermittleSchluesselZuNameWertPaaren(
            $HusstTarifpunktreferenz
            ; alsListe3238($ReferenzNamen)
            ; alsListe3238($ReferenzWerte)
        )
    )
}"
H2Pf_5_ermittleZielpunkte;;Husst Fachfunktionen;H;;"{ID_OTPTyp;ID_Bediengebiet:
	setzeVariable4002(Zielpunktliste
 	       ; ermittleWertZuSchluesselVonDatentabelle5070(
				ermittleDatentabelle5262(5 /HUSST-OTPTyp-Bediengebiet-zu-Tarifrelevanterpunkt/)
				; erzeugeListe3219($ID_OTPTyp; $ID_Bediengebiet)
			)
  	)
}"
H2Pf_802_ermittlePunktAuswahl;;Husst Fachfunktionen;H;;"{HusstPunkt:
	ermittleWertZuSchluesselVonDatentabelle5070(
        ermittleDatentabelle5262(""%HusstPunktAuswahl%"")
        ; $HusstPunkt
	)
}"
H2Pf_803_ermittlePunktAuswahlliste;;Husst Fachfunktionen;H;;"{PunkteAuswahl;HusstPunkte :
    wenn3016(
        istGleich3014(0; listeLaenge3072($HusstPunkte))
        ; $PunkteAuswahl
        ; H2Pf_803_ermittlePunktAuswahlliste(
            listeErgaenzt3077($PunkteAuswahl
                ; H2Pf_802_ermittlePunktAuswahl(
                    listeElement3071($HusstPunkte; 1)
                )
            )
            ; listeAbschnitt3074($HusstPunkte; 2; zahlSubtrahiert3218(listeLaenge3072($HusstPunkte); 1))
        )
    )
}"
H2Pf_804_ermittleHusstPunkt;NULL,PunktAuswahl:H2Ps_PunktAuswahlelement ->NULL,XML-Tarifpunkt-Typ;Husst Fachfunktionen;H;liefert eine HusstPunkt zu dem gegebenen PunktAuswahlobjekt oder NULL;{:undefiniert}
berechneWertMit3216;;PkmFachfunktionen;S;;3216
H2Pf_2_ermittleOrtspunktMitRefExt;;Husst Fachfunktionen;H;;"{VerkaufsStandortSchluessel:
ermittleWertZuSchluesselVonDatentabelle5070( 
			ermittleDatentabelle5262(2 / compilezeitkonstante %HUSST-Ortspunkt-ReferenzExtern-zu-PKMTarifpunktNr-Bediengebiet% /) 
			; alsText3091( $VerkaufsStandortSchluessel)
		) 
}"
H2Pf_2_ermittleOrtspunktMitIbisNr;;Husst Fachfunktionen;H;;"{VerkaufsStandortSchluessel:
ermittleWertZuSchluesselVonDatentabelle5070( 
			ermittleDatentabelle5262(3 / compilezeitkonstante %HUSST-Ortspunkt-IBISCode-zu-PKMTarifpunktNr-Bediengebiet% /) 
			; $VerkaufsStandortSchluessel
		) 
}"
liefereAusnahme3042;;PkmFachfunktionen;S;;3042
vorherigerHaltestelleText2036;;PkmFachfunktionen;S;;2036
erzeugeListe3219;;PkmFachfunktionen;S;;3219
wandleTarifpunkteToAnzeigeDaten;(Tarifpunkt[]):TarifpunktAnzeigeDaten[];;H;;"{listTarifpunkte: listeUmgewandelt($listTarifpunkte; iteratorTarifpunktToAnzeigeDaten)}"
listeUmgewandelt;;PkmFachfunktionen;S;;3082
iteratorTarifpunktToAnzeigeDaten;(Wert,Zahl,Wert[]):Wert;;H;;"{value;index;array:
	erzeugeListe3219(
		erzeugeListe3219(""Anzeigetext"");
		erzeugeListe3219(ermittleText(ermittleTarifpunkt5035($value);
								 AP-HUSST-Tarifpunkt-Start-Bezeichnung))
	)
}"
ermittleText;;;S;;5302
wandleStartTarifpunkteToAnzeigeDaten;():TarifpunktAnzeigeDaten[];;H;;"{:setzeVariable4002(AD.StartTarifpunkteAnzeige; wandleTarifpunkteToAnzeigeDaten(leseVariable4001(Startpunktliste)))}"
wandleZielTarifpunkteToAnzeigeDaten;():TarifpunktAnzeigeDaten[];;H;;"{:setzeVariable4002(AD.ZielTarifpunkteAnzeige; wandleTarifpunkteToAnzeigeDaten(leseVariable4001(Zielpunktliste)))}"
ermittleEinzelauswahl;;;S;;3034
leseAusgangsparameter;;;S;;4038
und3026;;PkmFachfunktion;S;;3026
ermittleZutarifpunkteZuZuordnungen5273;;PkmFachfunktion;S;;5272
ermittleVontarifpunkteZuZuordnungen5046;;PkmFachfunktion;S;;5046
ermittleNr5131;;PkmFachfunktion;S;;5131
ermittleIdentifikationsparameterwert5088;;PkmFachfunktion;S;;5088
ermittleTarifprodukteZuIdentifikationsparameterwerten5079;;;S;;5079
ermittlePreis5304;;PkmFachfunktion;S;;5304
ermittleWegevariante5333;;;S;;5333
ermittleBetragVonPreis5246;;PkmFachfunktion;S;;5246
ermittleMwstsatzVonPreis5018;;PkmFachfunktion;S;;5018
Sequenz-AK-HUSST-Ticket-Druck;;Ausgangssequenz;H;;"{:
	erzeugeListe3219(
		wenn3016(
			istGleich3014(AP-HUSST-Ticket-Sortedrucktext;aktuellerAusgangsparameter4068())
			;  ermittleText(leseVariable4001(VerkaufsSorteRelation);AP-HUSST-Ticket-Sortedrucktext)
			; undefiniert
		)
		;wenn3016(
			istGleich3014(AP-HUSST-Ticket-Preisstufedrucktext;aktuellerAusgangsparameter4068())
			; alsText3091(listeElement3071(leseVariable4001(VerkaufsVia);4))
			; undefiniert
		)
		;wenn3016(
			istGleich3014(AP-HUSST-Ticket-Preis;aktuellerAusgangsparameter4068())
			; textVerkettet3068(
					alsText3091(
						zahlDividiert3041(
							leseVariable4001(VerkaufPreisBetrag)
							;100
						)
					)
					; "".""
					; alsText3091(
						zahlDividiert3041(
							zahlDivisionsrest3133(
								leseVariable4001(VerkaufPreisBetrag)
								;100)
							;10
						)
					)
					; alsText3091(
						zahlDivisionsrest3133(
							zahlDivisionsrest3133(
								leseVariable4001(VerkaufPreisBetrag)
								;100
							)
						;10
						)
					)
					; ""€""
			)
			; undefiniert
		)
		;wenn3016(
			istGleich3014(AP-HUSST-Ticket-PreisMwSt;aktuellerAusgangsparameter4068())
			;  textVerkettet3068(alsText3091(leseVariable4001(VerkaufPreisMwSt));""%"")
			; undefiniert
		)
		;wenn3016(
			istGleich3014(AP-HUSST-Ticket-StartTarifpunktdrucktext;aktuellerAusgangsparameter4068())
			;  ermittleText(leseVariable4001(StartTarifpunkt);AP-HUSST-Ticket-StartTarifpunktdrucktext)
			; undefiniert
		)
		;wenn3016(
			istGleich3014(AP-HUSST-Ticket-ZielTarifpunktdrucktext;aktuellerAusgangsparameter4068())
			;  ermittleText(leseVariable4001(ZielTarifpunkt);AP-HUSST-Ticket-ZielTarifpunktdrucktext)
			; undefiniert
		)
		;wenn3016(
			istGleich3014(AP-HUSST-Ticket-Viadrucktext;aktuellerAusgangsparameter4068())
			;  ermittleText(leseVariable4001(ViaWegevariante);AP-HUSST-Ticket-Viadrucktext)
			; undefiniert
		)
	/ TODO Gueltigbeginn und Ende/
	)
}"
aktuellerAusgangsparameter4068;;PkmFachfunktion;S;;4068
textVerkettet3069;;;S;;3068
zahlDividiert3041;;;S;;3041
zahlDivisionsrest3133;;;S;;3133
Sequenz-AK-HUSST-StartTarifpunktAnzeige;;Ausgangssequenz;H;;"{:H2P_H_ListeToText(setzeAusgangsparameter(AP-Husst-Anzeige-Starttarifpunkte;wandleStartTarifpunkteToAnzeigeDaten()))}"
Sequenz-AK-HUSST-ZielTarifpunktAnzeige;;Ausgangssequenz;H;;"{:H2P_H_ListeToText(setzeAusgangsparameter(AP-Husst-Anzeige-Zieltarifpunkte;wandleZielTarifpunkteToAnzeigeDaten()))}"
Sequenz-AK-HUSST-ViaAuswahlAnzeige;;Ausgangssequenz;H;;"{:H2P_H_ListeToText(setzeAusgangsparameter(AP-Husst-Anzeige-Vias;wandleViasToAnzeigeDaten()))}"
wandleViasToAnzeigeDaten;():TarifpunktAnzeigeDaten[];;H;;"{:
setzeVariable4002(AD.ViaAuwahlAnzeige;
	listeUmgewandelt(
		leseVariable4001(Vialiste);
		iteratorViaToAnzeigeDaten
	)
)
}"
Sequenz-AK-HUSST-SortengruppenAnzeige;;Ausgangssequenz;H;;"{:H2P_H_ListeToText(setzeAusgangsparameter(AP-Husst-Anzeige-Sortengrupppen;wandleSortengruppenToAnzeigeDaten()))}"
wandleSortengruppenToAnzeigeDaten;():TarifpunktAnzeigeDaten[];;H;;"{:
setzeVariable4002(AD.SortengruppenAnzeige;
	listeUmgewandelt(
		leseVariable4001(VerkaufsSortengruppe);
		iteratorSortengruppeToAnzeigeDaten
	)
)
}"
H2P_H_ListeToText;(Werte[]):Text;;H;;"{Liste:
wenn3016(istListe($Liste);   
	alsText3091(
		listeUmgewandelt($Liste; H2P_H_ListeToTextIterator
	)
);
	alsText3091($Liste)
)
}"
H2P_H_ListeToTextIterator;(Werte[]):Text;;H;;"{value;index;array:
wenn3016(istGleich3014(listeLaenge3072($array);$index)
	;textVerkettet3068(
		""[""
		; $value
		; ""]""
	)  
	;textVerkettet3068(
		""[""
		; $value
		; ""]""
		; "",""
	)
)
}"
setzeAusgangsparameter;;;S;;4041
istListe;;;S;;3324
iteratorViaToAnzeigeDaten;(Wert,Zahl,Wert[]):Wert;;H;;"{value;index;array:
	erzeugeListe3219(
		erzeugeListe3219(""Anzeigetext"");
		erzeugeListe3219(listeElement3071($value;5))
	)
}"
iteratorSortengruppeToAnzeigeDaten;(Wert,Zahl,Wert[]):Wert;;H;;"{value;index;array:
	erzeugeListe3219(
		erzeugeListe3219(""Anzeigetext"");
		erzeugeListe3219($value)
	)
}"
